{
    admin off
    persist_config off
    auto_https off
    log {
        format json
    }
    servers {
        trusted_proxies static private_ranges 100.0.0.0/8
        protocols h1 h2c
    }
}

:{$PORT:3000} {
    log {
        format json
    }

    bind 0.0.0.0

    # Handle CORS
    header {
        Access-Control-Allow-Origin *
        Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS"
        Access-Control-Allow-Headers *
        -Server
    }

    rewrite /health /*

    root * dist
    encode gzip zstd
    file_server

    try_files {path} /index.html
}

